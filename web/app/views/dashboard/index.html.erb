<% content_for :page_title, "Live Dashboard" %>

<div class="dashboard">
  <div class="dashboard-header">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" data-controller="live-counter" data-live-counter-endpoint-value="/api/calls/active">
          <%= @active_calls || 0 %>
        </div>
        <div class="stat-label">Active Calls</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value" data-controller="live-counter" data-live-counter-endpoint-value="/api/calls/today">
          <%= @total_calls_today || 0 %>
        </div>
        <div class="stat-label">Calls Today</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value">
          <%= @agents_online || 0 %>
        </div>
        <div class="stat-label">Agents Online</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value">
          <%= Time.current.strftime("%H:%M") %>
        </div>
        <div class="stat-label">Current Time</div>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <div class="dashboard-grid">
      <div class="dashboard-section">
        <h3>Recent Calls</h3>
        <div class="recent-calls" data-controller="live-updates" data-live-updates-channel-value="DashboardChannel">
          <table class="data-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Number</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Agent</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_calls.each do |call| %>
                <tr>
                  <td><%= call.created_at.strftime("%H:%M") %></td>
                  <td><%= call.name %></td>
                  <td><%= call.description || "00:00" %></td>
                  <td><span class="status <%= call.status&.downcase %>"><%= call.status || 'active' %></span></td>
                  <td><%= call.user&.email || 'System' %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <div class="dashboard-section">
        <h3>Today's Summary</h3>
        <div class="summary-stats">
          <div class="summary-item">
            <span class="label">Total Calls:</span>
            <span class="value"><%= @todays_summary[:total_calls] %></span>
          </div>
          <div class="summary-item">
            <span class="label">Answered:</span>
            <span class="value"><%= @todays_summary[:answered_calls] %></span>
          </div>
          <div class="summary-item">
            <span class="label">Missed:</span>
            <span class="value"><%= @todays_summary[:missed_calls] %></span>
          </div>
          <div class="summary-item">
            <span class="label">Average Duration:</span>
            <span class="value"><%= @dashboard_stats.average_duration %></span>
          </div>
        </div>
      </div>

      <div class="dashboard-section">
        <h3>Additional Metrics</h3>
        <div class="summary-stats">
          <div class="summary-item">
            <span class="label">This Week:</span>
            <span class="value"><%= @dashboard_stats.calls_this_week %></span>
          </div>
          <div class="summary-item">
            <span class="label">This Month:</span>
            <span class="value"><%= @dashboard_stats.calls_this_month %></span>
          </div>
          <div class="summary-item">
            <span class="label">All Time:</span>
            <span class="value"><%= @dashboard_stats.total_calls_all_time %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>